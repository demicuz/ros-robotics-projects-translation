# 3.13. Работа с AIML в ROS

#### Создание пакета ros\_aiml

Выполните:

```text
$ catkin_create_pkg ros_aiml rospy std_msgs sound_play
```

Внутри пакета `ros_aiml` создайте папки с именами `data`, `scripts` и `launch` для хранения данных, файлов AIML, скриптов Python и файлы запуска ROS. Структура `ros_aiml`:

![](../../.gitbook/assets/image%20%286%29.png)

Вы можете хранить файлы AIML в папке `data`, и все файлы запуска могут быть сохранены внутри папки `launch`. Скрипты сохраняются в папке `scripts`. Давайте посмотрим на каждый скрипт.

#### Узел aiml\_server

Как мы уже обсуждали, `aiml_server` отвечает за загрузку и сохранение AIML и AIM файлы мозга. Он подписан на `/chatter`, которая является входным сигналом для AIML интерпретатора и публикует тему `/response`, которая является ответом от него. Это основной фрагмент кода `aiml_server.py`:

```text
def load_aiml(xml_file):
    data_path = rospy.get_param("aiml_path")
    print data_path
    os.chdir(data_path)
    
    if os.path.isfile("standard.brn"):
        mybot.bootstrap(brainFile = "standard.brn")
    else:
        mybot.bootstrap(learnFiles = xml_file, commands = "load aimlb")
        mybot.saveBrain("standard.brn")

def callback(data):
    input = data.data
    response = mybot.respond(input)
    rospy.loginfo("I heard:: %s",data.data)
    rospy.loginfo("I spoke:: %s",response)
    response_publisher.publish(response)

def listener():
    rospy.loginfo("Starting ROS AIML Server")
    rospy.Subscriber("chatter", String, callback)
    # spin() simply keeps python from exiting until this node is stopped
    rospy.spin()
    
if __name__ == '__main__':
    load_aiml('startup.xml')
    listener()
```

Этот узел ROS делает то же самое, что и код, который мы использовали для загрузки и сохранения AIML файлов. Этот код преобразуется в узел ROS, который может принимать входные данные и отправлять ответ через какую-то тему.

{% hint style="info" %}
Весь исходный код можно найти здесь: [https://github.com/qboticslabs/ros\_robotics\_projects](https://github.com/qboticslabs/ros_robotics_projects)
{% endhint %}



